title:: 14.5.3 自适应 Hash 索引

- 自适应哈希索引使 InnoDB 能够在缓冲池具有合适的工作负载和足够内存的系统上执行更像一个内存数据库/服务器/服务器/服务器，而不牺牲事务特性或可靠性。自适应哈希索引由 innodb_adaptive_hash_index 变量启用，或者在服务器启动时通过 -- skip-innodb-adaptive-hash-index 关闭。
	- aliyun 提供的rds mysql 是关闭的  innodb_adaptive_hash_index=OFF
- 根据观察到的搜索模式，使用索引键的前缀构建哈希索引。前缀可以是任何长度，并且可能只有 b 树中的某些值出现在哈希索引中。哈希索引是根据经常访问的索引页面的需求构建的。
- 如果表几乎完全适合于主内存，则哈希索引通过启用直接查找任何元素来加快查询速度，将索引值转换为一种指针。有一个监控索引搜索的机制。如果 InnoDB 注意到查询可以从构建哈希索引中受益，它就会自动这样做。
- 对于某些工作负载，哈希索引查找的加速大大超过了监控索引查找和维护哈希索引结构的额外工作。在繁重的工作负载（例如多个并发连接）下，对自适应哈希索引的访问有时会成为争用的来源。带有 LIKE运算符和% 通配符的查询也往往不会受益。对于不能从自适应哈希索引中受益的工作负载，关闭它可以减少不必要的性能开销。因为很难提前预测自适应哈希索引功能是否适合特定系统和工作负载，请考虑在启用和禁用它的情况下运行基准测试。
- 在 MySQL 5.7 中，自适应哈希索引功能是分区的。每个索引都绑定到一个特定的分区，每个分区都由一个单独的锁存器保护。分区由 innodb_adaptive_hash_index_parts 变量控制。在早期版本中，自适应哈希索引功能受单个锁存器的保护，这可能成为繁重工作负载下的竞争点。该 innodb_adaptive_hash_index_parts 变量默认设置为 8。最大设置为 512。
- 您可以在输出SEMAPHORES部分 监控自适应哈希索引的使用和争用 。SHOW ENGINE INNODB STATUS如果有许多线程等待在 中创建的 rw-latch btr0sea.c，请考虑增加自适应哈希索引分区的数量或禁用自适应哈希索引。
- 有关哈希索引的性能特征的信息，请参阅第 [[8.3.8 节 B-Tree 和哈希索引的比较]]。
-
-