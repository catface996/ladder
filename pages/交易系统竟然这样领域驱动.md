- # 前言
	- 设计是仁者见仁智者见智的事情。
	- 不同的设计方案，对实施人员的要求不一样
		- 行级锁
			- 如果是使用主键，大概了不会出问题，但往往需要根据查询条件过滤出需要的数据，在用命中的数据的ID来锁定。
			- 如果是用唯一约束，基本也不会出问题，需要开发同学明确唯一约束的规则，并且锁定条件正好是命中唯一约束的。
			- 普通索引，存在锁定数据行膨胀问题
		- 定时任务批量拉取数据
			- 通过分页，对页码的增长来逐页读取数据
			- 通过偏移量，固定读取偏移量后的一页
			- 通过时间排序，固定读取第一页，但要求读取后，更新已读取数据的修改时间
- # 概念
	- 主单
	- 子单
	- 拆单
- # 职责
	- 交易订单业务拆分
	- 业务一致性协调
	- 交易链路监控
- # 模型
	- 交易主单
	- 交易子单（业务子单，非店铺子单）
		- 库存占用
		- 支付单
		- ...
- # 状态机
	- 一致性协调原则
		- 以明确的结果触发状态的转移
		- 即：未知结果不影响当前状态
	- 状态机可以根据操作+操作结果来做状态转移
	- 当前的状态，可以计算出应该做的动作
- # 业务流程
	- 本地主单和子单的一致性性创建
	- 推进本地子单和其他系统子单的一致性
	- 最终实现本地交易单据和其他系统业务单据的最终一致性
- # 依赖倒置的 [[SPI]] 接口
	- try接口
	- confirm接口
	- cancel接口
- # RPC
	- 任何一次网络调用都会存在三种可能
		- 明确的成功
		- 明确的失败
		- 未知
			- 可能成功
			- 可能失败
		-