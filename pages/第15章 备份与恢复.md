- 为什么要备份
	- 灾难恢复
	- 人们改变想法
		- 后悔了，想恢复数据
	- 审计
	- 测试
- 定义恢复需求
	- 备份在先。只有已经做好了备份才可能恢复。
	- 备份由脚本和任务自动完成。
	- 备份时日常任务，但恢复尝尝发生在危机情形下。
	- 因为安全的需要，如果正在做异地备份，可能要对备份数据进行加密，或采取其他措施来进行保护。
	- 只有一个人来规划、设计和实施备份，是糟糕的选择。
	- 在不导致严重后果的情况下，可以容忍都是多少数据？
	- 恢复需要在多长时间内完成？
	- 需要恢复什么？
- 设计MySQL备份方案
	- 在生产实践中，对于大数据库来说，物理备份时必须的。逻辑备份太慢并受到资源限制，从逻辑备份中恢复需要很长的时间。
	- 保留多个备份集。
	- 定期冲逻辑备份或者物理备份中抽取数据进行恢复测试。
	- 保存二进制日志以用于基于故障时间点的恢复。
	- 完全不借助备份工具本身来监控备份和备份的过程。需要另外验证备份是否正常。
	- 通过演练整个恢复过程来测试备份和恢复。测试恢复所需要的资源（CPU，磁盘空间，实际时间，以及网络带宽等）
	- 对安全性要仔细考虑。
- 在线备份还是离线备份
	- 关闭MySQL做备份时最简单最安全的，也是获取一致性副本的方法中最好的，并且发生损坏或不一致的风险最小。
	- 在规划备份时，有一些与性能相关的额因素要考虑：
		- 锁时间
		- 备份时间
		- 备份负载
		- 恢复时间
- 逻辑备份还是物理备份
	- 逻辑备份
		- 优点：
			- 逻辑备份时可以用编辑器或者像grep和sed之类的命令查看和操作的普通文件。
			- 恢复非常简单。
			- 可以通过网络来备份和恢复，就是说，可以在与MySQL主机不同的另一台机器上操作。
			- 非常灵活
			- 与存储引擎无关。
			- 有助于避免数据损坏。
		- 缺点：
			- 必须由数据库服务器完成逻辑备份的工作，因此需要大量的CPU周期。
			- 逻辑备份在某些场景下比数据库文件本身更大。
				- 例如整形，用ASCII来备份，可能需要12个字符。
			- 无法保证导出后再还原出来的一定是同样的数据。
				- 浮点表示问题，软件Bug等
			- 从逻辑备份中还原需要MySQL加载和解释语句，转化为存储格式，并重建索引，所以这一切会很慢。
	- 物理备份
		- 优点：
			- 基于文件的物理备份，只需要复制文件，不需要其他额外的工作。
			- 物理备份恢复简单，取决于存储引擎。
			- InnoDB和MyISAM的物理备份非常容易跨平台、操作系统和MySQL版本。
			- 从物理备份中恢复会更快。
		- 缺点：
			- InnoDB原始文件通常比相对应的逻辑备份要大得多
				- 表空间的其他用途（插入缓冲，回滚段等）
			- 物理备份不总是可以跨平台、操作系统以及MySQL版本。
- 备份什么
	- 非显著数据
	- 代码
	- 复制配置
	- 服务器配置
	- 选定的操作系统文件
	- 增量备份和差异备份
- 存储引擎和一致性
	- 数据一致性
	- 文件一致性
	- 复制
		- 在备库上做备份
- 管理和备份二进制日志
	- 对基于时间点的恢复是必须的
	- 二进制日志格式
		- 时间的日期和时间
		- 原服务器的服务器ID，防止复制之间的无限循环和其他问题
		- end_log_pos，下一个事件的便宜字节值
		- 事件类型
		- 原服务器上执行时间的线程ID
		- exec_time
		- 在原服务器上事件产生的错误代码
	- 安全地清除老的二进制日志
		- 用rm删除日志会导致mysql-bin.index状态文件与磁盘上的文件不一致
- 备份数据
	- 生成逻辑别分
		- SQL导出
		- schema和数据存储在一起
		- 巨大的SQL语句
		- 单个巨大的文件
		- 逻辑备份的成本很高
		- 符号分隔文件备份
	- 文件系统快照
		- Linux的[[LVM]]
		- [[LVM]]快照是如何工作的
			- copy-on-write
		- 先决条件
			- 所有InnoDB文件（InnoDB的表空间文件和InnoDB的事务日志）必须是在单个逻辑卷（分区）。你需要绝对的时间一致性性，LVM不能为多于一个卷做某个时间点一致的快照。
			- 如果需要备份表定义，MySQL数据目录必须在相同的逻辑卷中。
			- 必须在卷组中有足够的空闲空间来创建快照。
- 从备份中恢复
	- 恢复物理备份
	- 还原逻辑备份
	- 基于时间点的恢复
	- 更高级的恢复技术
		- 用于快速恢复的延时复制
		- 使用日志服务器进行恢复
	- InnoDB崩溃恢复
		- InnoDB损坏的原因
			- InnoDB依赖于无缓存的I/O调用和fsync()调用，直到数据完全地写入到物理介质上才会返回。如果硬件不能保证写入的持久化，InnoDB也就不能保证数据的持久化，崩溃就有可能导致数据损坏。
		- 如何恢复损坏的InnoDB数据
			- 二级索引损坏
				- optimize table来修复二级索引
			- 聚簇索引损坏
			- 损坏系统结构
- 备份和恢复工具
	- 略
- 备份脚本化
	- 安全检测
	- 命令行参数
	- 连接MySQL
	- 停止和启动MySQL
	- 获取数据库和表的列表
	- 对表加锁、刷新并解锁
	- 刷新二进制日志
	- 获取二进制日志位置
	- 导出数据
	- 复制数据
- 总结
	- 备库不是备份
-